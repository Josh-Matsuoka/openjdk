---
apiVersion: template.openshift.io/v1
kind: Template
metadata:
  annotations:
    description: Template to produce an imagestream and buildconfig for a Jlink builder image
  name: jlink-builder-template
  namespace: openshift
objects:
- apiVersion: image.openshift.io/v1
  kind: ImageStream
  metadata:
    generation: 1
    name: ubi9-openjdk-${JDK_VERSION}-jlink
    namespace: default
  spec:
    lookupPolicy:
      local: false
  status:
    dockerImageRepository: image-registry.openshift-image-registry.svc:5000/default/ubi9-openjdk-${JDK_VERSION}-jlink
    publicDockerImageRepository: default-route-openshift-image-registry.apps-crc.testing/default/ubi9-openjdk-${JDK_VERSION}-jlink
- apiVersion: build.openshift.io/v1
  kind: BuildConfig
  metadata: 
    name: jlink-builder-jdk-${JDK_VERSION}
    labels:
      app: jlink-builder-jdk-${JDK_VERSION}
  spec:
    source:
      dockerfile: |
        FROM -
        USER 0
        RUN microdnf --setopt=install_weak_deps=0 --setopt=tsflags=nodocs install -y java-${JDK_VERSION}-openjdk-jmods
        USER 185
    strategy:
      dockerStrategy:
        from: 
          kind: ImageStreamTag
          name: ubi9-openjdk-${JDK_VERSION}:1.18
    output:
      to:
        kind: ImageStreamTag
        name: ubi9-openjdk-${JDK_VERSION}-jlink:latest
parameters:
- description: JDK version to produce a jmods image and imagestream for
  name: JDK_VERSION
  value: "11"
  required: true